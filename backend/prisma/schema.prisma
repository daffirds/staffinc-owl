generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Client {
  id           String              @id @default(uuid()) @db.Uuid
  name         String
  createdAt    DateTime            @default(now()) @map("created_at")
  requirements ClientRequirement[]

  @@map("clients")
}

model ClientRequirement {
  id                       String      @id @default(uuid()) @db.Uuid
  clientId                 String      @map("client_id") @db.Uuid
  roleTitle                String      @map("role_title")
  rawContent               String?     @map("raw_content")
  standardizedRequirements String?     @map("standardized_requirements")
  createdAt                DateTime    @default(now()) @map("created_at")
  candidates               Candidate[]
  client                   Client      @relation(fields: [clientId], references: [id])

  @@map("client_requirements")
}

model Interviewer {
  id         String      @id @default(uuid()) @db.Uuid
  name       String
  createdAt  DateTime    @default(now()) @map("created_at")
  candidates Candidate[]

  @@map("interviewers")
}

model Candidate {
  id                            String             @id @default(uuid()) @db.Uuid
  clientRequirementId           String?            @map("client_requirement_id") @db.Uuid
  interviewerId                 String?            @map("interviewer_id") @db.Uuid
  candidateName                 String?            @map("candidate_name")
  role                          String?
  interviewDate                 DateTime?          @map("interview_date")
  rawInternalNotes              String?            @map("raw_internal_notes")
  rawInternalScores             String?            @map("raw_internal_scores")
  rawClientFeedback             String?            @map("raw_client_feedback")
  standardizedInternalNotes     String?            @map("standardized_internal_notes")
  standardizedScores            String?            @map("standardized_scores")
  avgInternalScore              Decimal?           @map("avg_internal_score") @db.Decimal(4, 2)
  standardizedClientFeedback    String?            @map("standardized_client_feedback")
  isAccepted                    Boolean?           @map("is_accepted")
  hasHiddenCriteria             Boolean            @default(false) @map("has_hidden_criteria")
  hasAssessmentConflict         Boolean            @default(false) @map("has_assessment_conflict")
  hasScoreMismatch              Boolean            @default(false) @map("has_score_mismatch")
  hiddenCriteriaExplanation     String?            @map("hidden_criteria_explanation")
  assessmentConflictExplanation String?            @map("assessment_conflict_explanation")
  createdAt                     DateTime           @default(now()) @map("created_at")
  status                        String?            @default("processing") @db.VarChar(50)
  processing_started_at         DateTime?          @default(now()) @db.Timestamp(6)
  status_updated_at             DateTime?          @default(now()) @db.Timestamp(6)
  processing_error              String?
  requirement                   ClientRequirement? @relation(fields: [clientRequirementId], references: [id], onDelete: Restrict)
  interviewer                   Interviewer?       @relation(fields: [interviewerId], references: [id])
  documents                     Document[]

  @@index([id], map: "idx_candidates_id")
  @@index([status, status_updated_at], map: "idx_candidates_status")
  @@map("candidates")
}

model Document {
  id               String    @id @default(uuid()) @db.Uuid
  candidateId      String    @map("candidate_id") @db.Uuid
  documentType     String?   @map("document_type")
  filePath         String?   @map("file_path")
  originalFilename String?   @map("original_filename")
  contentType      String?   @map("content_type")
  extractedText    String?   @map("extracted_text")
  uploadedAt       DateTime  @default(now()) @map("uploaded_at")
  candidate        Candidate @relation(fields: [candidateId], references: [id])

  @@map("documents")
}
