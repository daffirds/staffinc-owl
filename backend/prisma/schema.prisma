// https://www.prisma.io/docs/orm/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Client {
  id           String              @id @default(uuid()) @db.Uuid
  name         String
  createdAt    DateTime            @default(now()) @map("created_at")
  requirements ClientRequirement[]

  @@map("clients")
}

model ClientRequirement {
  id                       String      @id @default(uuid()) @db.Uuid
  clientId                 String      @map("client_id") @db.Uuid
  roleTitle                String      @map("role_title")
  rawContent               String?     @map("raw_content")
  standardizedRequirements String?     @map("standardized_requirements")
  createdAt                DateTime    @default(now()) @map("created_at")
  
  client     Client      @relation(fields: [clientId], references: [id])
  candidates Candidate[]

  @@map("client_requirements")
}

model Interviewer {
  id         String      @id @default(uuid()) @db.Uuid
  name       String
  createdAt  DateTime    @default(now()) @map("created_at")
  candidates Candidate[]

  @@map("interviewers")
}

model Candidate {
  id                            String    @id @default(uuid()) @db.Uuid
  clientRequirementId           String    @map("client_requirement_id") @db.Uuid
  interviewerId                 String?   @map("interviewer_id") @db.Uuid
  candidateName                 String?   @map("candidate_name")
  role                          String?
  interviewDate                 DateTime? @map("interview_date")
  
  // Raw inputs
  rawInternalNotes              String?   @map("raw_internal_notes")
  rawInternalScores             String?   @map("raw_internal_scores")
  rawClientFeedback             String?   @map("raw_client_feedback")
  
  // Processed data
  standardizedInternalNotes     String?   @map("standardized_internal_notes")
  standardizedScores            String?   @map("standardized_scores")
  avgInternalScore              Decimal?  @map("avg_internal_score") @db.Decimal(4, 2)
  standardizedClientFeedback    String?   @map("standardized_client_feedback")
  
  isAccepted                    Boolean?  @map("is_accepted")
  
  // Gap Metrics
  hasHiddenCriteria             Boolean   @default(false) @map("has_hidden_criteria")
  hasAssessmentConflict         Boolean   @default(false) @map("has_assessment_conflict")
  hasCalibrationGap             Boolean   @default(false) @map("has_calibration_gap")
  hasScoreMismatch              Boolean   @default(false) @map("has_score_mismatch")
  
  hiddenCriteriaExplanation     String?   @map("hidden_criteria_explanation")
  assessmentConflictExplanation String?   @map("assessment_conflict_explanation")
  calibrationGapExplanation     String?   @map("calibration_gap_explanation")
  
  createdAt                     DateTime  @default(now()) @map("created_at")

  requirement ClientRequirement @relation(fields: [clientRequirementId], references: [id])
  interviewer Interviewer?      @relation(fields: [interviewerId], references: [id])
  documents   Document[]

  @@map("candidates")
}

model Document {
  id               String    @id @default(uuid()) @db.Uuid
  candidateId      String    @map("candidate_id") @db.Uuid
  documentType     String?   @map("document_type")
  filePath         String?   @map("file_path")
  originalFilename String?   @map("original_filename")
  contentType      String?   @map("content_type")
  extractedText    String?   @map("extracted_text")
  uploadedAt       DateTime  @default(now()) @map("uploaded_at")
  
  candidate Candidate @relation(fields: [candidateId], references: [id])

  @@map("documents")
}
